{"ast":null,"code":"import _regeneratorRuntime from\"/Users/rphl/Projects/XWordsApp/crosswords/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/rphl/Projects/XWordsApp/crosswords/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/rphl/Projects/XWordsApp/crosswords/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from'react';import{Link}from'react-router-dom';import useGlobalState from'../utils/useGlobalState';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Login=function Login(){var globalState=useGlobalState();var _globalState$user=globalState.user,username=_globalState$user.username,api_token=_globalState$user.api_token;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),wantLogin=_useState2[0],setWantLogin=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),login=_useState4[0],setLogin=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),pass=_useState6[0],setPass=_useState6[1];var _React$useState=React.useState({}),_React$useState2=_slicedToArray(_React$useState,2),errors=_React$useState2[0],setErrors=_React$useState2[1];React.useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!username){_context.next=12;break;}_context.prev=1;_context.next=4;return fetch(process.env.REACT_APP_API_URL+'/auth/user/',{method:'GET',headers:{'Content-Type':'application/json','Authorization':'Token '+api_token}});case 4:res=_context.sent;if(!(res.status!==200)){_context.next=7;break;}throw new Error('not logged in');case 7:_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);globalState.setUser({});case 12:case\"end\":return _context.stop();}}},_callee,null,[[1,9]]);}))();},[globalState,api_token,username]);React.useEffect(function(){if(!wantLogin){setErrors({});}},[wantLogin]);var onLogin=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var res,data,json;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();_context2.next=3;return fetch(process.env.REACT_APP_API_URL+'/auth/login',{method:'POST',credentials:'omit',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:login,password:pass})});case 3:res=_context2.sent;if(!(res.status===400)){_context2.next=11;break;}_context2.next=7;return res.json();case 7:data=_context2.sent;setErrors(data);_context2.next=16;break;case 11:setWantLogin(false);_context2.next=14;return res.json();case 14:json=_context2.sent;globalState.setUser({username:json.username,api_token:json.token});case 16:case\"end\":return _context2.stop();}}},_callee2);}));return function onLogin(_x){return _ref2.apply(this,arguments);};}();var onLogout=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:globalState.setUser({});window.location=\"/\";case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function onLogout(){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'40px',position:'relative',zIndex:2e3},children:[username&&/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'right'},children:[/*#__PURE__*/_jsx(Link,{to:\"/\",children:/*#__PURE__*/_jsx(\"button\",{class:\"btn btn-secondary btn-sm\",children:\"Index\"})}),\" \",/*#__PURE__*/_jsxs(\"button\",{onClick:onLogout,className:\"btn btn-danger btn-sm\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-power-off\"}),\" Quitter\"]}),\"\\xA0\"]}),!username&&/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'right'},children:[/*#__PURE__*/_jsx(Link,{to:\"/\",children:/*#__PURE__*/_jsx(\"button\",{class:\"btn btn-secondary btn-sm\",children:\"Index\"})}),\" \",/*#__PURE__*/_jsxs(\"button\",{\"data-testid\":\"loginBtn\",onClick:function onClick(){return setWantLogin(true);},className:\"btn btn-primary btn-sm\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-sign-in-alt\"}),\" Enregistrement\"]}),\"\\xA0\"]}),!username&&wantLogin&&/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"modal\",role:\"dialog\",style:{display:'block'},children:/*#__PURE__*/_jsx(\"div\",{className:\"modal-dialog\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"modal-header\",style:{padding:'35px 50px'},children:/*#__PURE__*/_jsxs(\"h4\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-sign-in-alt\"}),\"  Enregistrement\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",style:{padding:'40px 50px'},children:[errors.non_field_errors&&errors.non_field_errors.map(function(e){return/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",role:\"alert\",dangerouslySetInnerHTML:{__html:e}});}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:onLogin,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"username\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-user\"}),\" Nom d'utilisateur\"]}),/*#__PURE__*/_jsx(\"input\",{onChange:function onChange(e){setLogin(e.target.value);},type:\"text\",className:\"form-control\",id:\"username\",name:\"username\",placeholder:\"Nom d'utilisateur\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"password\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-key\"}),\" Mot de passe\"]}),/*#__PURE__*/_jsx(\"input\",{onChange:function onChange(e){setPass(e.target.value);},type:\"password\",className:\"form-control\",id:\"password\",name:\"password\",placeholder:\"Mot de passe\"})]}),/*#__PURE__*/_jsxs(\"button\",{\"data-testid\":\"submitLoginBtn\",type:\"submit\",className:\"btn btn-primary btn-block\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-sign-in-alt\"}),\"  Entrer\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"modal-footer\",style:{display:'block',justifyContent:'initial'},children:/*#__PURE__*/_jsxs(\"button\",{type:\"submit\",className:\"btn btn-danger btn-default pull-left\",\"data-dismiss\":\"modal\",onClick:function onClick(){return setWantLogin(false);},children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-times\"}),\" Retour\"]})})]})})})})]});};export default Login;","map":{"version":3,"sources":["/Users/rphl/Projects/XWordsApp/crosswords/frontend/src/components/login.js"],"names":["React","useState","Link","useGlobalState","Login","globalState","user","username","api_token","wantLogin","setWantLogin","login","setLogin","pass","setPass","errors","setErrors","useEffect","fetch","process","env","REACT_APP_API_URL","method","headers","res","status","Error","setUser","onLogin","e","preventDefault","credentials","body","JSON","stringify","password","json","data","token","onLogout","window","location","marginBottom","position","zIndex","textAlign","display","padding","non_field_errors","map","__html","target","value","justifyContent"],"mappings":"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","sourcesContent":["import React, { useState } from 'react'\nimport { Link } from 'react-router-dom'\nimport useGlobalState from '../utils/useGlobalState'\n\nconst Login = () => {\n    const globalState = useGlobalState()\n    const { username, api_token } = globalState.user\n    const [wantLogin, setWantLogin] = useState(false)\n    const [login, setLogin] = useState(false)\n    const [pass, setPass] = useState(false)\n    const [errors, setErrors] = React.useState({})\n\n    React.useEffect(()=>{\n      (async () => {\n        if (username) {\n          try {\n            const res = await fetch(process.env.REACT_APP_API_URL + '/auth/user/', {\n              method: 'GET',\n              headers: {\n                  'Content-Type': 'application/json',\n                  'Authorization': 'Token ' + api_token,\n              }\n            })\n            if (res.status !== 200) {\n              throw new Error('not logged in')\n            }\n          } catch (e) {\n            globalState.setUser({})\n          }\n        }\n      })()\n    }, [globalState, api_token, username])\n  \n    React.useEffect(() => {\n      if (!wantLogin){\n        setErrors({});\n      }\n    }, [wantLogin])\n\n    const onLogin = async (e) => {\n      e.preventDefault()\n      const res = await fetch(process.env.REACT_APP_API_URL + '/auth/login', {\n        method: 'POST',\n        credentials: 'omit',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({username: login, password: pass})\n      })\n      if(res.status === 400) {\n        const data = await res.json()\n        setErrors(data)\n      } else {\n        setWantLogin(false)\n        const json = await res.json()\n        globalState.setUser({username: json.username, api_token: json.token})\n      }\n    }\n    const onLogout = async () => {\n      globalState.setUser({})\n      window.location = \"/\"\n    }\n    return (\n      <div style={{marginBottom: '40px', position: 'relative', zIndex: 2e3}}>\n      {username && <div style={{textAlign:'right'}}>\n          <Link to=\"/\"><button class=\"btn btn-secondary btn-sm\">Index</button></Link> <button onClick={onLogout} className=\"btn btn-danger btn-sm\"><i className=\"fas fa-power-off\"></i> Quitter</button>&nbsp;\n        </div>}\n      {!username && (<div style={{textAlign:'right'}}>\n        <Link to=\"/\"><button class=\"btn btn-secondary btn-sm\">Index</button></Link> <button data-testid=\"loginBtn\" onClick={()=>setWantLogin(true)} className=\"btn btn-primary btn-sm\"><i className=\"fas fa-sign-in-alt\"></i> Enregistrement</button>\n          &nbsp;\n        </div>)}\n      {!username && wantLogin && (<div>\n        <div className=\"modal\" role=\"dialog\" style={{display: 'block'}}>\n          <div className=\"modal-dialog\">\n            <div className=\"modal-content\">\n              <div className=\"modal-header\" style={{padding:'35px 50px'}}>\n                <h4><i className=\"fas fa-sign-in-alt\"></i>  Enregistrement</h4>\n              </div>\n              <div className=\"modal-body\" style={{padding:'40px 50px'}}>\n                {errors.non_field_errors && errors.non_field_errors.map(e=>\n                    <div className=\"alert alert-danger\" role=\"alert\" dangerouslySetInnerHTML={{__html: e}}></div>\n                )}\n                <form onSubmit={onLogin}>\n                  <div className=\"form-group\">\n                    <label htmlFor=\"username\"><i className=\"fas fa-user\"></i> Nom d'utilisateur</label>\n                    <input onChange={(e)=>{setLogin(e.target.value)}} type=\"text\" className=\"form-control\" id=\"username\" name=\"username\" placeholder=\"Nom d'utilisateur\"/>\n                  </div>\n                  <div className=\"form-group\">\n                    <label htmlFor=\"password\"><i className=\"fas fa-key\"></i> Mot de passe</label>\n                    <input onChange={(e)=>{setPass(e.target.value)}} type=\"password\" className=\"form-control\" id=\"password\" name=\"password\" placeholder=\"Mot de passe\"/>\n                  </div>\n                  <button data-testid=\"submitLoginBtn\" type=\"submit\" className=\"btn btn-primary btn-block\"><i className=\"fas fa-sign-in-alt\"></i>  Entrer</button>\n                </form>\n              </div>\n              <div className=\"modal-footer\" style={{display:'block', justifyContent:'initial'}}>\n                <button type=\"submit\" className=\"btn btn-danger btn-default pull-left\" data-dismiss=\"modal\" onClick={()=>setWantLogin(false)}><i className=\"fas fa-times\"></i> Retour</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>)\n      }\n      </div>\n    )\n  }\n  \n  export default Login"]},"metadata":{},"sourceType":"module"}